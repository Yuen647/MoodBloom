@startuml
start

:用户打开应用;
:输入心情记录;

if (是否已登录？) then (是)
  :提交心情记录请求;
  :调用身份验证服务验证身份;
  if (身份验证成功？) then (是)
    :调用心情记录服务;
    
    fork
      :获取用户当前位置;
      :调用位置服务返回位置数据;
    fork again
      :获取当前位置的天气信息;
      :调用天气服务返回天气数据;
    end fork
    
    :调用情感分析服务分析心情;
    :保存心情记录到数据库;
    
    if (是否有图片上传？) then (是)
      :处理图片上传;
      :调用图片上传服务;
    else (否)
      :无图片上传;
    endif
    
    :返回心情记录和AI分析结果;
    :显示成功消息给用户;
  else (否)
    :显示身份验证失败信息;
  endif
else (否)
  :提示用户登录;
endif

:操作完成;
stop
@enduml
